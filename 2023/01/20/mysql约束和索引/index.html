<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic|Fira Code, Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"running-noob.github.io",root:"/",scheme:"Muse",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!0,transition:{post_body:"slideDownIn",sidebar:"slideDownIn"}},path:"search.xml"}</script><meta name="description" content="约束和索引"><meta property="og:type" content="article"><meta property="og:title" content="mysql约束和索引"><meta property="og:url" content="https://running-noob.github.io/2023/01/20/mysql%E7%BA%A6%E6%9D%9F%E5%92%8C%E7%B4%A2%E5%BC%95/index.html"><meta property="og:site_name" content="Running Noob"><meta property="og:description" content="约束和索引"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-01-20T13:02:54.000Z"><meta property="article:modified_time" content="2023-12-14T13:14:38.724Z"><meta property="article:author" content="Fzy"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://running-noob.github.io/2023/01/20/mysql%E7%BA%A6%E6%9D%9F%E5%92%8C%E7%B4%A2%E5%BC%95/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>mysql约束和索引 | Running Noob</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Running Noob</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Do Something Meaningful</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">22</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-book fa-fw"></i>文章<span class="badge">242</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a href="https://github.com/Running-Noob" class="github-corner" title="访问我的GitHub" aria-label="访问我的GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://running-noob.github.io/2023/01/20/mysql%E7%BA%A6%E6%9D%9F%E5%92%8C%E7%B4%A2%E5%BC%95/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Fzy"><meta itemprop="description" content="华东理工大学 - 计算机硕士在读<br>研究方向：云计算"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Running Noob"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">mysql约束和索引</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-01-20 21:02:54" itemprop="dateCreated datePublished" datetime="2023-01-20T21:02:54+08:00">2023-01-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-12-14 21:14:38" itemprop="dateModified" datetime="2023-12-14T21:14:38+08:00">2023-12-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><ul><li>约束和索引</li></ul></blockquote><span id="more"></span><h2 id="★★★第24-5章-约束和索引"><a href="#★★★第24-5章-约束和索引" class="headerlink" title="★★★第24.5章 约束和索引"></a>★★★第24.5章 约束和索引</h2><h3 id="★★★24-5-1-约束"><a href="#★★★24-5-1-约束" class="headerlink" title="★★★24.5.1 约束"></a>★★★24.5.1 约束</h3><ul><li><p>关系数据库存储分解为多个表的数据，每个表存储相应的数据。利用键来建立从一个表到另一个表的引用（由此产生了术语引用完整性（referential integrity））。</p><p>正确地进行关系数据库设计，需要一种方法保证只在表中插入合法数据。例如，如果 Orders 表存储订单信息，OrderItems 表存储订单详细内容，应该保证 OrderItems 中引用的任何订单 ID 都存在于 Orders 中。类似地，在 Orders 表中引用的任意顾客必须存在于 Customers 表中。</p><p>虽然可以在插入新行时进行检查（在另一个表上执行 SELECT，以保证所有值合法并存在），但最好不要这样做，原因如下。</p><ul><li>如果在客户端层面上实施数据库完整性规则，则每个客户端都要被迫实施这些规则，一定会有一些客户端不实施这些规则。</li><li>在执行 UPDATE 和 DELETE 操作时，也必须实施这些规则。</li><li>执行客户端检查是非常耗时的，而 DBMS 执行这些检查会相对高效。</li></ul></li><li><p><strong>约束（constraint）：管理如何插入或处理数据库数据的规则。</strong></p></li><li><p>DBMS 通过在数据库表上施加约束来实施引用完整性。在 <code>MySQL</code> 中，约束包括：</p><ol><li><code>NOT NULL</code> -&gt; 非空，一般来说，<strong>将 <code>NOT NULL</code> 和 <code>DEFAULT</code> 组合使用</strong>，是一种设计习惯</li><li><code>UNIQUE</code> -&gt; 唯一</li><li><code>PRIMARY KEY</code> -&gt; 主键</li><li><code>FOREIGN KEY</code> -&gt; 外键</li><li><code>CHECK</code> -&gt; 检查</li></ol><p>五种。</p></li></ul><h4 id="24-5-1-1-主键PRIMARY-KEY"><a href="#24-5-1-1-主键PRIMARY-KEY" class="headerlink" title="24.5.1.1 主键PRIMARY KEY"></a>24.5.1.1 主键PRIMARY KEY</h4><ul><li><p>主键是一种特殊的约束，用来<strong>保证一列（或一组列）中的值是唯一的，而且永不改动</strong>。换句话说，表中的一列（或多个列）的值唯一标识表中的每一行。这方便了直接或交互地处理表中的行。没有主键，要安全地 UPDATE 或 DELETE 特定行而不影响其他行会非常困难。表中任意列只要满足以下条件，都可以用于主键：</p><ul><li>任意两行的主键值都不相同。</li><li>每行都具有一个主键值（即列中不允许 NULL 值）。</li><li>包含主键值的列从不修改或更新。</li><li>主键值不能重用。如果从表中删除某一行，其主键值不分配给新行。</li></ul></li><li><p>主键的基本使用：在创建表时，在字段后面加上 <code>PRIMARY KEY</code> 关键字：</p><p><code>字段名 字段数据类型 PRIMARY KEY</code></p></li><li><p><strong>主键的使用细节</strong>：</p><ol><li><p><code>PRIMARY KEY</code> 不能重复而且不能为 <code>NULL</code>。</p></li><li><p>一张表最多只能有一个主键，但可以是复合主键，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_table(</span><br><span class="line">	id INT NOT NULL AUTO_INCREMENT,</span><br><span class="line">	`name` VARCHAR(32) NOT NULL,</span><br><span class="line">	job VARCHAR(255),</span><br><span class="line">	PRIMARY KEY(id, `name`)		-- 复合主键</span><br><span class="line">)ENGINE INNODB;</span><br></pre></td></tr></table></figure></li><li><p>主键的指定方式有两种：</p><ul><li>直接在字段名后指定：字段名 <code>PRIMARY KEY</code>。</li><li>在表定义最后写 <code>PRIMARY KEY(列名)</code>。</li></ul></li><li><p>使用 <code>DESC 表名</code>，可以看到 <code>PRIMARY KEY</code> 的情况。</p></li><li><p>在实际开发中，每个表往往都会设计有主键。</p></li></ol></li></ul><h4 id="24-5-1-2-外键FOREIGN-KEY"><a href="#24-5-1-2-外键FOREIGN-KEY" class="headerlink" title="24.5.1.2 外键FOREIGN KEY"></a>24.5.1.2 外键FOREIGN KEY</h4><ul><li><p>外键是表中的一列，其值必须列在另一表的主键中。外键用于定义主表和从表之间的关系，是保证引用完整性的极其重要部分。<strong>外键约束要定义在从表上，主表则必须具有主键约束或者是 <code>UNIQUE</code> 约束。当定义外键约束后，要求外键列数据必须在主表的主键列存在或者为 <code>NULL</code>。</strong></p></li><li><p>外键的基本语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FOREIGN KEY (本表字段名) REFERENCES 主表名(主键名或UNIQUE字段名)</span><br></pre></td></tr></table></figure></li><li><p>我们举个例子来理解外键：</p><ul><li>Orders 表将录入到系统的每个订单作为一行包含其中。顾客信息存储在Customers 表中。Orders 表中的订单通过顾客 ID 与 Customers 表中的特定行相关联。顾客 ID 为 Customers 表的主键，每个顾客都有唯一的ID。订单号为 Orders 表的主键，每个订单都有唯一的订单号。Orders 表中顾客 ID 列的值不一定是唯一的。如果某个顾客有多个订单，则有多个行具有相同的顾客 ID（虽然每个订单都有不同的订单号）。同时，Orders 表中顾客 ID 列的合法值为 Customers 表中顾客的 ID。</li></ul><p>这就是外键的作用。在这个例子中，<strong>在 Orders 的顾客 ID 列上定义了一个外键，因此该列只能接受 Customers 表的主键值。</strong></p></li><li><p><strong>外键有助防止意外删除</strong>：在定义外键后，DBMS 不允许删除在另一个表中具有关联行的行。例如，不能删除关联订单的顾客。<strong>删除该顾客的唯一方法是首先删除相关的订单（这表示还要删除相关的订单项）</strong>。由于需要一系列的删除，因而利用外键可以防止意外删除数据。</p><p>有的 DBMS 支持称为级联删除（cascading delete）的特性。如果启用，该特性在从一个表中删除行时删除所有相关的数据。例如，如果启用级联删除并且从 Customers 表中删除某个顾客，则任何关联的订单行也会被自动删除。</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql外键.jpg)</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql外键2.jpg)</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql外键3.jpg)</p></li><li><p><strong>外键的使用细节</strong>：</p><ol><li>外键指向的表的字段，要求是 <code>PRIMARY KEY</code> 或者是 <code>UNIQUE</code>。</li><li>表的引擎类型要是 <code>InnoDB</code>，这样的表才支持外键。</li><li>外键字段的类型要和主键字段的类型一致（长度可不同）。</li><li>**外键字段的值，必须在主键字段中出现过，或者为 <code>NULL</code> [前提是外键字段允许<code>NULL</code>]**。</li><li>一旦建立主外键的关系，数据不能随意删除了。</li></ol><p>第四点和第五点可以总结为：<strong>主表记录不能乱删（要先把从表中相关记录删完，才能删），从表记录不能乱加（主表中要有相应的相关记录）</strong>。</p></li></ul><h4 id="24-5-1-3-唯一约束UNIQUE"><a href="#24-5-1-3-唯一约束UNIQUE" class="headerlink" title="24.5.1.3 唯一约束UNIQUE"></a>24.5.1.3 唯一约束UNIQUE</h4><ul><li><p>唯一约束用来保证一列（或一组列）中的数据是唯一的。它们类似于主键，但存在以下重要区别。</p><ul><li><p>表可包含多个唯一约束 <code>UNIQUE</code> ，但每个表只允许一个主键。</p></li><li><p>如果没有指定 <code>NOT NULL</code>，则唯一约束列可包含 <code>NULL</code> 值，且可以有多个 <code>NULL</code> 值。</p><p>如果一个列指定为 <code>UNIQUE NOT NULL</code>，则其使用效果类似于 <code>PRIMARY KEY</code>。</p></li><li><p>唯一约束列可修改或更新。</p></li><li><p>唯一约束列的值可重复使用。</p></li><li><p>与主键不一样，唯一约束不能用来定义外键。</p></li></ul><p>employees 表是一个使用约束的例子。每个雇员都有唯一的社会安全号，但我们并不想用它作主键，因为它太长（而且我们也不想使该信息容易利用）。因此，每个雇员除了其社会安全号外还有唯一的雇员 ID（主键）。雇员 ID 是主键，可以确定它是唯一的。你可能还想使 DBMS 保证每个社会安全号也是唯一的（保证输入错误不会导致使用他人号码）。可以通过在社会安全号列上定义 <strong>UNIQUE</strong> 约束做到。唯一约束的语法类似于其他约束的语法。唯一约束既可以用 UNIQUE 关键字在表定义中定义，也可以用单独的 CONSTRAINT 定义。</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql唯一约束.jpg)</p></li></ul><h4 id="24-5-1-4-检查约束CHECK"><a href="#24-5-1-4-检查约束CHECK" class="headerlink" title="24.5.1.4 检查约束CHECK"></a>24.5.1.4 检查约束CHECK</h4><ul><li><p>检查约束用来保证一列（或一组列）中的数据满足一组指定的条件。检查约束的常见用途有以下几点。</p><ul><li>检查最小或最大值。例如，防止 0 个物品的订单（即使 0 是合法的数）。</li><li>指定范围。例如，保证发货日期大于等于今天的日期，但不超过今天起一年后的日期。</li><li>只允许特定的值。例如，在性别字段中只允许 M 或 F。</li></ul><p>换句话说，数据类型限制了列中可保存的数据的类型。<strong>检查约束在数据类型内又做了进一步的限制</strong>，这些限制极其重要，可以确保插入数据库的数据正是你想要的数据。不需要依赖于客户端应用程序或用户来保证正确获取它，DBMS 本身将会拒绝任何无效的数据。</p></li><li><p><code>CHECK</code> 的基本语法：在创建表时，在字段后面加上 <code>CHECK</code> 关键字及约束条件：<code>列名 类型 CHECK (CHECK 条件)</code>。或者如下图所示：</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql检查约束.jpg)</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql检查约束2.jpg)</p><p>![](../../../../../Running Noob/计算机/Typora笔记/笔记-git仓库/Mysql_notebook/img/mysql检查约束3.jpg)</p></li><li><p>注意：<code>mysql5.7</code> 目前还不支持 <code>CHECK</code>，<strong>只做语法校验，但不会生效</strong>。</p></li></ul><h3 id="24-5-2-索引INDEX"><a href="#24-5-2-索引INDEX" class="headerlink" title="24.5.2 索引INDEX"></a>24.5.2 索引INDEX</h3><ul><li><p>索引用来排序数据以加快搜索和排序操作的速度。想像一本书后的索引（如本书后的索引），可以帮助你理解数据库的索引。</p><p>假如要找出本书中所有的“数据类型”这个词，简单的办法是从第 1 页开始，浏览每一行。虽然这样做可以完成任务，但显然不是一种好的办法。浏览少数几页文字可能还行，但以这种方式浏览整部书就不可行了。随着要搜索的页数不断增加，找出所需词汇的时间也会增加。</p><p>这就是书籍要有索引的原因。<strong>索引按字母顺序列出词汇及其在书中的位置。为了搜索“数据类型”一词，可在索引中找出该词，确定它出现在哪些页中。然后再翻到这些页，找出“数据类型”一词。</strong></p><p>使索引有用的因素是什么？很简单，就是恰当的排序。找出书中词汇的困难不在于必须进行多少搜索，而在于书的内容没有按词汇排序。如果书的内容像字典一样排序，则索引没有必要（因此字典就没有索引）。</p><p>数据库索引的作用也一样。<strong>主键数据总是排序的</strong>，这是 DBMS 的工作。因此，按主键检索特定行总是一种快速有效的操作。</p><p>但是，搜索其他列中的值通常效率不高。例如，如果想搜索住在某个州的客户，怎么办？因为表数据并未按州排序，DBMS必须读出表中所有行（从第一行开始），看其是否匹配。这就像要从没有索引的书中找出词汇一样。</p><p>解决方法是使用索引。可以在一个或多个列上定义索引，使 DBMS 保存其内容的一个排过序的列表。在定义了索引后，DBMS 以使用书的索引类似的方法使用它。<strong>DBMS 搜索排过序的索引，找出匹配的位置，然后检索这些行。</strong></p></li><li><p>在开始创建索引前，应该记住以下内容。</p><ul><li>索引改善检索操作的性能，但降低了数据插入、修改和删除的性能。在执行这些操作时，DBMS 必须动态地更新索引。</li><li>索引数据可能要占用大量的存储空间。</li><li>并非所有数据都适合做索引。取值不多的数据（如州）不如具有更多可能值的数据（如姓或名），能通过索引得到那么多的好处。</li><li>索引用于数据过滤和数据排序。如果你经常以某种特定的顺序排序数据，则该数据可能适合做索引。</li><li>可以在索引中定义多个列（例如，州加上城市）。这样的索引仅在以州加城市的顺序排序时有用。如果想按城市排序，则这种索引没有用处。</li></ul></li><li><p>下面的语句在 Products 表的产品名列上创建一个简单的索引。</p><p><code>CREATE INDEX prod_name_ind ON products (prod_name);</code></p><p>索引必须唯一命名。这里的索引名 prod_name_ind 在关键字 CREATE INDEX 之后定义。ON 用来指定被索引的表，而索引中包含的列（此例中仅有一列）在表名后的圆括号中给出。</p></li><li><p>注意：创建索引后，只对创建了索引的列有效。</p></li></ul><h4 id="25-5-2-1-索引的原理"><a href="#25-5-2-1-索引的原理" class="headerlink" title="25.5.2.1 索引的原理"></a>25.5.2.1 索引的原理</h4><ol><li>当我们没有索引时，在寻找符合 <code>WHERE</code> 过滤条件的记录时，要进行<strong>全表扫描</strong>寻找，查询速度慢。</li><li>在对表中的某列创建索引时，会<strong>建立关于该索引列的数据结构</strong>，例如二叉搜索树、B树、B+树。</li><li>索引的代价：<ul><li>在创建索引后，会增大表对磁盘存储空间的占用。</li><li>同时会对 <code>UPDATE</code>、<code>DELETE</code>、<code>INSERT</code> 语句的效率产生影响，因为要对已经建立好的数据结构进行同步调整。</li></ul></li></ol><h4 id="25-5-2-2-MySQL索引类型"><a href="#25-5-2-2-MySQL索引类型" class="headerlink" title="25.5.2.2 MySQL索引类型"></a>25.5.2.2 MySQL索引类型</h4><ul><li>索引的类型：<ol><li>主键索引，主键自动的为主索引（类型 <code>PRIMARY KEY</code>）。-&gt; 主键，同时也是索引（主键索引）</li><li>唯一索引（<code>UNIQUE</code>）。</li><li>普通索引（<code>INDEX</code>）。</li><li>全文索引（<code>FULLTEXT</code>）[适用于 <code>MyISAM</code> ]。<ul><li>开发中对全文搜索考虑使用：<code>Solr</code> 和 <code>ElasticSearch (ES)</code>，而不用 <code>MySQL</code> 自带的 <code>FULLTEXT</code>。</li></ul></li></ol></li></ul><h4 id="25-5-2-3-索引的使用"><a href="#25-5-2-3-索引的使用" class="headerlink" title="25.5.2.3 索引的使用"></a>25.5.2.3 索引的使用</h4><h5 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h5><ol><li><p><code>CREATE [UNIQUE] INDEX index_name ON table_name (column_name);</code> ：</p><ul><li><p>添加唯一索引，等同于在创建字段时添加 <code>UNIQUE</code> 关键字。</p><p>如果某列的值是不会重复的，则优先考虑使用 <code>UNIQUE</code> 索引，否则使用普通索引。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE UNIQUE INDEX id_index ON t25 (id);</span><br></pre></td></tr></table></figure></li><li><p>添加普通索引：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX id_index ON t25 (id);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>ALTER TABLE table_name ADD INDEX index_name (column_name);</code>。</p></li></ol><ul><li>添加主键索引：<code>ALTER TABLE table_name ADD PRIMARY KEY(列名...);</code></li></ul><h5 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h5><ul><li><p><code>DROP INDEX index_name ON table_name;</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX id_index ON t25;</span><br></pre></td></tr></table></figure></li><li><p>删除主键索引：<code>ALTER TABLE table_name DROP PRIMARY KEY;</code></p></li></ul><h5 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h5><ul><li>先删除，再添加新的索引。</li></ul><h5 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h5><ol><li><code>SHOW INDEXES FROM table_name;</code></li><li><code>SHOW INDEX FROM table_name;</code></li><li><code>SHOW KEYS FROM table_name;</code></li></ol><ul><li>在 <code>SHOW INDEX</code>，<code>SHOW INDEXES</code> 和 <code>SHOW KEYS</code> 之间没有区别。它们有类似的含义。</li></ul><h4 id="25-5-2-4-创建索引规则"><a href="#25-5-2-4-创建索引规则" class="headerlink" title="25.5.2.4 创建索引规则"></a>25.5.2.4 创建索引规则</h4><ol><li><p><strong>较频繁的作为查询条件字段应该创建索引</strong>。</p></li><li><p>唯一性太差的字段不适合单独创建索引，即使频繁作为查询条件。</p><p><code>select * from emp where sex = '男';</code></p></li><li><p><strong>更新非常频繁的字段不适合创建索引</strong>。</p></li><li><p>不会出现在 <code>WHERE</code> 子句中的字段不该创建索引。</p></li></ol></div><div><div><div style="text-align:center;color:#555;font-size:16px">---------------The End---------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Fzy</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://running-noob.github.io/2023/01/20/mysql%E7%BA%A6%E6%9D%9F%E5%92%8C%E7%B4%A2%E5%BC%95/" title="mysql约束和索引">https://running-noob.github.io/2023/01/20/mysql约束和索引/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/2023/01/19/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" rel="prev" title="mysql存储过程"><i class="fa fa-chevron-left"></i> mysql存储过程</a></div><div class="post-nav-item"><a href="/2023/01/21/mysql%E4%BA%8B%E5%8A%A1/" rel="next" title="mysql事务">mysql事务 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">个人信息</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%98%85%E2%98%85%E2%98%85%E7%AC%AC24-5%E7%AB%A0-%E7%BA%A6%E6%9D%9F%E5%92%8C%E7%B4%A2%E5%BC%95"><span class="nav-text">★★★第24.5章 约束和索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%98%85%E2%98%85%E2%98%8524-5-1-%E7%BA%A6%E6%9D%9F"><span class="nav-text">★★★24.5.1 约束</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#24-5-1-1-%E4%B8%BB%E9%94%AEPRIMARY-KEY"><span class="nav-text">24.5.1.1 主键PRIMARY KEY</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24-5-1-2-%E5%A4%96%E9%94%AEFOREIGN-KEY"><span class="nav-text">24.5.1.2 外键FOREIGN KEY</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24-5-1-3-%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9FUNIQUE"><span class="nav-text">24.5.1.3 唯一约束UNIQUE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24-5-1-4-%E6%A3%80%E6%9F%A5%E7%BA%A6%E6%9D%9FCHECK"><span class="nav-text">24.5.1.4 检查约束CHECK</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-5-2-%E7%B4%A2%E5%BC%95INDEX"><span class="nav-text">24.5.2 索引INDEX</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#25-5-2-1-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-text">25.5.2.1 索引的原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-5-2-2-MySQL%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B"><span class="nav-text">25.5.2.2 MySQL索引类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-5-2-3-%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">25.5.2.3 索引的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="nav-text">添加索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E7%B4%A2%E5%BC%95"><span class="nav-text">修改索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95"><span class="nav-text">查询索引</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-5-2-4-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E8%A7%84%E5%88%99"><span class="nav-text">25.5.2.4 创建索引规则</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Fzy" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">Fzy</p><div class="site-description" itemprop="description">华东理工大学 - 计算机硕士在读<br>研究方向：云计算</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">文章</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">分类</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Running-Noob" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Running-Noob" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://juejin.cn/user/840506988304424" title="Juejin → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;840506988304424" rel="noopener" target="_blank"><i class="fa custom juejin fa-fw"></i>Juejin</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Fzy</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">469k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">28:24</span></div><div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("08/13/2022 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script></div><div class="powered-by">Powered by Hexo & NexT</div></div></footer></div><script color="108,108,108" opacity="0.5" zindex="-1" count="0" src="/lib/canvas-nest/canvas-nest-nomobile.min.js"></script><script size="300" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script defer src="/lib/three/three.min.js"></script><script src="/js/local-search.js"></script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script></body></html>